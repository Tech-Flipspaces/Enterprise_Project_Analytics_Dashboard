{% for item in metrics_list %}
<div class="col-md-3 col-sm-6 animate-card">
    <div class="metric-card {% if is_post %}card-post{% else %}card-pre{% endif %} d-flex flex-column justify-content-between">
        
        <div>
            <h6 class="metric-label text-truncate" title="{{ item.label }}">
                {{ item.label }}
            </h6>
            <div class="d-flex align-items-baseline mt-2">
                <h2 class="metric-value mb-0 count-up" data-target="{{ item.count }}">0</h2>
                <small class="text-muted ms-2 fw-bold">Projects</small>
            </div>
        </div>

        <div class="mt-3 pt-3 border-top">
            
            <div class="d-flex justify-content-between align-items-center mb-2">
                
                <form method="GET" class="d-inline-flex align-items-center" onsubmit="return true;">
                    <input type="hidden" name="view" value="{{ request.GET.view }}">
                    <input type="hidden" name="start" value="{{ request.GET.start }}">
                    <input type="hidden" name="end" value="{{ request.GET.end }}">
                    <input type="hidden" name="metric_role" value="{{ request.GET.metric_role }}">
                    
                    {% for s in request.GET.getlist.sbu %}
                        <input type="hidden" name="sbu" value="{{ s }}">
                    {% endfor %}
                    
                    {% for k, v in request.GET.items %}
                        {% if 'f_' in k %}
                            {% for val in request.GET.getlist.k %}
                                <input type="hidden" name="{{ k }}" value="{{ val }}">
                            {% endfor %}
                            <input type="hidden" name="{{ k }}" value="{{ v }}">
                        {% endif %}
                    {% endfor %}
                    
                    <i class="fas fa-filter me-1 opacity-50 small"></i>
                    <input type="number" step="0.01" name="{{ item.param }}" value="{{ item.threshold }}" 
                        class="form-control form-control-sm border-0 bg-transparent p-0 fw-bold text-primary" 
                        style="width: 60px; height: auto;"
                        onchange="this.form.submit()">
                </form>
                
                {% if item.success_cat %}
                    <span class="badge bg-{{ item.success_color|default:'secondary'}} 
                                 {% if item.success_color in 'warning,info,light' %}text-dark{% else %}text-white{% endif %} 
                                 border small px-2" 
                          style="font-size: 0.7em;">
                        {{ item.success_cat }}
                    </span>
                {% endif %}
            </div>

            <button type="button" 
                    class="btn btn-sm w-100 {% if is_post %}btn-outline-success{% else %}btn-outline-primary{% endif %} opacity-75"
                    data-bs-toggle="popover" 
                    data-bs-trigger="focus" 
                    data-bs-placement="top"
                    data-bs-html="true"
                    title="<div class='d-flex justify-content-between align-items-center'><span>{{ item.label }}</span><span class='badge bg-secondary'>{{ item.count }}</span></div>"
                    data-bs-content="<div class='dropdown-scroll-area'>
                        {% if item.project_list %}
                            {% for p in item.project_list %}
                                <div class='border-bottom py-1 small text-dark'><i class='fas fa-angle-right text-muted me-2'></i>{{ p }}</div>
                            {% endfor %}
                        {% else %}
                            <div class='text-muted text-center py-2'>No projects match criteria</div>
                        {% endif %}
                    </div>">
                View List <i class="fas fa-chevron-right ms-1" style="font-size: 0.8em;"></i>
            </button>
        </div>
    </div>
</div>
{% endfor %}